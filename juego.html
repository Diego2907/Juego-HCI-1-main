<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juego de Laberinto</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/phaser/3.55.2/phaser.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: #2c3e50;
            font-family: Arial, sans-serif;
        }
        #game-container {
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }
    </style>
</head>
<body>
    <div id="game-container"></div>
    
    <script>
        const config = {
            type: Phaser.AUTO,
            width: 800,
            height: 600,
            parent: 'game-container',
            physics: {
                default: 'arcade',
                arcade: {
                    gravity: { y: 0 },
                    debug: false
                }
            },
            scene: {
                preload: preload,
                create: create,
                update: update
            }
        };

        const game = new Phaser.Game(config);
        
        let player;
        let enemies = [];
        let walls;
        let goal;
        let cursors;
        let currentLevel = 1;
        let levelText;
        let startPos = { x: 50, y: 50 };

        // Definición de laberintos para cada nivel
        const mazes = {
            1: [
                [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
                [1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1],
                [1,0,1,0,1,0,1,1,1,1,1,1,1,1,0,1],
                [1,0,1,0,0,0,0,0,0,0,0,0,0,1,0,1],
                [1,0,1,1,1,1,1,1,0,1,1,1,0,1,0,1],
                [1,0,0,0,0,0,0,1,0,1,0,0,0,1,0,1],
                [1,1,1,1,1,1,0,1,0,1,0,1,1,1,0,1],
                [1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1],
                [1,0,1,1,1,1,1,1,1,1,0,1,0,1,1,1],
                [1,0,0,0,0,0,0,0,0,0,0,1,0,0,2,1],
                [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
            ],
            2: [
                [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
                [1,0,0,0,0,0,1,0,0,0,1,0,0,0,0,1],
                [1,0,1,1,1,0,1,0,1,0,1,0,1,1,0,1],
                [1,0,1,0,0,0,0,0,1,0,0,0,0,1,0,1],
                [1,0,1,0,1,1,1,1,1,1,1,1,0,1,0,1],
                [1,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1],
                [1,0,1,1,1,1,1,0,1,1,0,1,1,1,0,1],
                [1,0,1,0,0,0,0,0,0,1,0,0,0,0,0,1],
                [1,0,1,0,1,1,1,1,0,1,1,1,1,1,0,1],
                [1,0,0,0,0,0,0,0,0,0,0,0,0,0,2,1],
                [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
            ],
            3: [
                [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
                [1,0,0,0,1,0,0,0,0,0,0,0,1,0,0,1],
                [1,0,1,0,1,0,1,1,1,1,1,0,1,0,1,1],
                [1,0,1,0,0,0,1,0,0,0,0,0,0,0,0,1],
                [1,0,1,1,1,1,1,0,1,1,1,1,1,1,0,1],
                [1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1],
                [1,1,1,0,1,1,1,1,1,0,1,1,0,1,0,1],
                [1,0,0,0,1,0,0,0,0,0,1,0,0,1,0,1],
                [1,0,1,1,1,0,1,1,1,1,1,0,1,1,0,1],
                [1,0,0,0,0,0,0,0,0,0,0,0,0,0,2,1],
                [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
            ]
        };

        function preload() {
            // No necesitamos precargar imágenes ya que usaremos gráficos
        }

        function create() {
            // Crear grupo de paredes
            walls = this.physics.add.staticGroup();
            
            // Construir el laberinto
            buildMaze(this, currentLevel);
            
            // Crear jugador
            player = this.add.circle(startPos.x, startPos.y, 15, 0x3498db);
            this.physics.add.existing(player);
            player.body.setCollideWorldBounds(true);
            
            // Crear enemigos según el nivel
            createEnemies(this, currentLevel);
            
            // Texto del nivel
            levelText = this.add.text(16, 16, `Nivel: ${currentLevel}`, {
                fontSize: '24px',
                fill: '#fff',
                fontStyle: 'bold'
            });
            
            // Controles
            cursors = this.input.keyboard.createCursorKeys();
            
            // Colisiones
            this.physics.add.collider(player, walls);
            enemies.forEach(enemy => {
                this.physics.add.collider(enemy, walls);
                this.physics.add.overlap(player, enemy, hitEnemy, null, this);
            });
            this.physics.add.overlap(player, goal, reachGoal, null, this);
        }

        function buildMaze(scene, level) {
            const maze = mazes[level];
            const tileSize = 50;
            
            for (let row = 0; row < maze.length; row++) {
                for (let col = 0; col < maze[row].length; col++) {
                    const x = col * tileSize + tileSize / 2;
                    const y = row * tileSize + tileSize / 2;
                    
                    if (maze[row][col] === 1) {
                        // Pared
                        const wall = scene.add.rectangle(x, y, tileSize, tileSize, 0x34495e);
                        walls.add(wall);
                    } else if (maze[row][col] === 2) {
                        // Meta
                        goal = scene.add.circle(x, y, 20, 0x2ecc71);
                        scene.physics.add.existing(goal, true);
                    }
                }
            }
        }

        function createEnemies(scene, level) {
            // Limpiar enemigos anteriores
            enemies.forEach(enemy => enemy.destroy());
            enemies = [];
            
            // Crear tantos enemigos como el nivel indica
            for (let i = 0; i < level; i++) {
                let validPosition = false;
                let x, y;
                
                // Buscar una posición válida (no en pared y lejos del jugador)
                while (!validPosition) {
                    x = Phaser.Math.Between(100, 700);
                    y = Phaser.Math.Between(100, 500);
                    
                    // Verificar que esté lejos del inicio del jugador
                    const distance = Phaser.Math.Distance.Between(x, y, startPos.x, startPos.y);
                    
                    // Verificar que no haya colisión con paredes
                    const testCircle = scene.add.circle(x, y, 12);
                    scene.physics.add.existing(testCircle);
                    
                    const overlapping = scene.physics.overlap(testCircle, walls);
                    testCircle.destroy();
                    
                    if (!overlapping && distance > 150) {
                        validPosition = true;
                    }
                }
                
                const enemy = scene.add.circle(x, y, 12, 0xe74c3c);
                scene.physics.add.existing(enemy);
                enemy.body.setCollideWorldBounds(true);
                enemy.speed = 80 + (level * 20); // Velocidad incrementa con el nivel
                enemies.push(enemy);
            }
        }

        function update() {
            // Movimiento del jugador
            const speed = 200;
            player.body.setVelocity(0);
            
            if (cursors.left.isDown) {
                player.body.setVelocityX(-speed);
            } else if (cursors.right.isDown) {
                player.body.setVelocityX(speed);
            }
            
            if (cursors.up.isDown) {
                player.body.setVelocityY(-speed);
            } else if (cursors.down.isDown) {
                player.body.setVelocityY(speed);
            }
            
            // Movimiento de enemigos (persiguen al jugador)
            enemies.forEach(enemy => {
                const angle = Phaser.Math.Angle.Between(
                    enemy.x, enemy.y,
                    player.x, player.y
                );
                
                enemy.body.setVelocity(
                    Math.cos(angle) * enemy.speed,
                    Math.sin(angle) * enemy.speed
                );
            });
        }

        function hitEnemy(player, enemy) {
            // Reiniciar posición del jugador
            player.x = startPos.x;
            player.y = startPos.y;
            player.body.setVelocity(0, 0);
            
            // Mostrar mensaje temporal
            const text = this.add.text(400, 300, '¡Te atraparon!', {
                fontSize: '32px',
                fill: '#e74c3c',
                fontStyle: 'bold'
            }).setOrigin(0.5);
            
            this.time.delayedCall(1000, () => {
                text.destroy();
            });
        }

        function reachGoal(player, goal) {
            if (currentLevel < 3) {
                currentLevel++;
                this.scene.restart();
            } else {
                // Victoria final
                const victory = this.add.text(400, 300, '¡Ganaste todos los niveles!', {
                    fontSize: '32px',
                    fill: '#2ecc71',
                    fontStyle: 'bold',
                    backgroundColor: '#000',
                    padding: { x: 20, y: 10 }
                }).setOrigin(0.5);
                
                this.physics.pause();
                
                this.time.delayedCall(3000, () => {
                    currentLevel = 1;
                    this.scene.restart();
                });
            }
        }
    </script>
</body>
</html>